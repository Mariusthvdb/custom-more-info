!function(){"use strict";function e(e,t,n,o){if("a"===n&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?o:"a"===n?o.call(e):o?o.value:t.get(e)}function t(e,t,n,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(e,n):i?i.value=n:t.set(e,n),n}function n(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))}function o(e,t,n,o){if("a"===n&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?o:"a"===n?o.call(e):o?o.value:t.get(e)}function i(e,t,n,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(e,n):i?i.value=n:t.set(e,n),n}"function"==typeof SuppressedError&&SuppressedError,"function"==typeof SuppressedError&&SuppressedError;const s="$",r=":host",a="invalid selector";function c(e,t,n,o,i=!1){return new Promise((s=>{let r=0;const c=()=>{const l=i?e.querySelectorAll(t):e.querySelector(t);i&&l.length||!i&&null!==l?s(l):(r++,r<n?setTimeout(c,o):s(i?document.querySelectorAll(a):null))};c()}))}function l(e,t,n){return new Promise((o=>{let i=0;const s=()=>{const r=e.shadowRoot;r?o(r):(i++,i<t?setTimeout(s,n):o(null))};s()}))}function _(e){return e instanceof Promise?e:Promise.resolve(e)}function O(e,t,o,i){return n(this,void 0,void 0,(function*(){let n=null;const a=e.length;for(let _=0;_<a;_++){if(0===_)if(e[_].length)n=yield c(t,e[_],o,i);else{if(t instanceof Document)throw new SyntaxError(`You can not select a shadowRoot (${s}) of the document.`);n=t.shadowRoot?yield c(t.shadowRoot,e[++_],o,i):null}else{const t=yield l(n,o,i);n=t?yield c(t,`${r} ${e[_]}`,o,i):null}if(null===n)return null}return n}))}function h(e,t,o,i){return n(this,void 0,void 0,(function*(){const n=function(e,t){return function(e){return e.split(",").map((e=>e.trim()))}(e).map((e=>{const n=function(e){return e.split(s).map((e=>e.trim()))}(e);return t(n)}))}(e,(e=>{if(!e[e.length-1].length)throw new SyntaxError(function(e,t){return`${e} cannot be used with a selector ending in a shadowRoot (${s}).${t?` If you want to select a shadowRoot, use ${t} instead.`:""}`}("asyncQuerySelector","asyncShadowRootQuerySelector"));return e})),r=n.length;for(let e=0;e<r;e++){const s=yield O(n[e],t,o,i);if(s)return s}return null}))}var A,d;function f(...e){return n(this,void 0,void 0,(function*(){if((e=>{const[t,n]=e;return(o=t)&&(o instanceof Document||o instanceof Element)&&"string"==typeof n;var o})(e)){const[t,n,o]=e;return yield h(n,t,(null==o?void 0:o.retries)||10,(null==o?void 0:o.delay)||10)}const[t,n]=e;return yield h(t,document,(null==n?void 0:n.retries)||10,(null==n?void 0:n.delay)||10)}))}let E=class e{constructor(e,t){A.set(this,void 0),d.set(this,void 0),e instanceof Node||e instanceof Promise?(i(this,A,e,"f"),i(this,d,Object.assign({retries:10,delay:10},t||{}),"f")):(i(this,A,document,"f"),i(this,d,Object.assign({retries:10,delay:10},e||{}),"f"))}get element(){return _(o(this,A,"f")).then((e=>e instanceof NodeList?e[0]||null:e))}get[(A=new WeakMap,d=new WeakMap,s)](){const t=_(o(this,A,"f")).then((e=>e instanceof Document||e instanceof ShadowRoot||null===e||e instanceof NodeList&&0===e.length?null:e instanceof NodeList?l(e[0],o(this,d,"f").retries,o(this,d,"f").delay):l(e,o(this,d,"f").retries,o(this,d,"f").delay)));return new e(t,o(this,d,"f"))}get all(){return _(o(this,A,"f")).then((e=>e instanceof NodeList?e:document.querySelectorAll(a)))}get asyncParams(){return o(this,d,"f")}eq(e){return n(this,void 0,void 0,(function*(){return _(o(this,A,"f")).then((t=>t instanceof NodeList&&t[e]||null))}))}query(t){const n=_(o(this,A,"f")).then((e=>null===e||e instanceof NodeList&&0===e.length?null:e instanceof NodeList?c(e[0],t,o(this,d,"f").retries,o(this,d,"f").delay,!0):c(e,t,o(this,d,"f").retries,o(this,d,"f").delay,!0)));return new e(n,o(this,d,"f"))}};function u(e,t,n,o){if("a"===n&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?o:"a"===n?o.call(e):o?o.value:t.get(e)}function I(e,t,n,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(e,n):i?i.value=n:t.set(e,n),n}"function"==typeof SuppressedError&&SuppressedError;const N="$",L={retries:100,delay:50};var w,R,v,T,H;!function(e){e.HOME_ASSISTANT="HOME_ASSISTANT",e.HOME_ASSISTANT_MAIN="HOME_ASSISTANT_MAIN",e.HA_DRAWER="HA_DRAWER",e.HA_SIDEBAR="HA_SIDEBAR"}(w||(w={})),function(e){e.PARTIAL_PANEL_RESOLVER="PARTIAL_PANEL_RESOLVER",e.HA_PANEL_LOVELACE="HA_PANEL_LOVELACE",e.HUI_ROOT="HUI_ROOT",e.HEADER="HEADER",e.HUI_VIEW="HUI_VIEW"}(R||(R={})),function(e){e.HA_MORE_INFO_DIALOG="HA_MORE_INFO_DIALOG",e.HA_DIALOG="HA_DIALOG",e.HA_DIALOG_CONTENT="HA_DIALOG_CONTENT",e.HA_MORE_INFO_DIALOG_INFO="HA_MORE_INFO_DIALOG_INFO",e.HA_DIALOG_MORE_INFO_HISTORY_AND_LOGBOOK="HA_DIALOG_MORE_INFO_HISTORY_AND_LOGBOOK",e.HA_DIALOG_MORE_INFO_SETTINGS="HA_DIALOG_MORE_INFO_SETTINGS"}(v||(v={})),function(e){e.ON_LOVELACE_PANEL_LOAD="onLovelacePanelLoad",e.ON_LOVELACE_MORE_INFO_DIALOG_OPEN="onLovelaceMoreInfoDialogOpen",e.ON_LOVELACE_HISTORY_AND_LOGBOOK_DIALOG_OPEN="onLovelaceHistoryAndLogBookDialogOpen",e.ON_LOVELACE_SETTINGS_DIALOG_OPEN="onLovelaceSettingsDialogOpen"}(T||(T={})),function(e){e.HOME_ASSISTANT="home-assistant",e.HOME_ASSISTANT_MAIN="home-assistant-main",e.HA_DRAWER="ha-drawer",e.HA_SIDEBAR="ha-sidebar",e.PARTIAL_PANEL_RESOLVER="partial-panel-resolver",e.HA_PANEL_LOVELACE="ha-panel-lovelace",e.HUI_ROOT="hui-root",e.HEADER=".header",e.HUI_VIEW="hui-view",e.HA_MORE_INFO_DIALOG="ha-more-info-dialog",e.HA_DIALOG="ha-dialog",e.HA_DIALOG_CONTENT=".content",e.HA_MORE_INFO_DIALOG_INFO="ha-more-info-info",e.HA_DIALOG_MORE_INFO_HISTORY_AND_LOGBOOK="ha-more-info-history-and-logbook",e.HA_DIALOG_MORE_INFO_SETTINGS="ha-more-info-settings"}(H||(H={}));const m={[w.HOME_ASSISTANT]:{selector:H.HOME_ASSISTANT,children:{shadowRoot:{selector:N,children:{[w.HOME_ASSISTANT_MAIN]:{selector:H.HOME_ASSISTANT_MAIN,children:{shadowRoot:{selector:N,children:{[w.HA_DRAWER]:{selector:H.HA_DRAWER,children:{[w.HA_SIDEBAR]:{selector:H.HA_SIDEBAR,children:{shadowRoot:{selector:N}}}}}}}}}}}}}},S={[R.PARTIAL_PANEL_RESOLVER]:{selector:H.PARTIAL_PANEL_RESOLVER,children:{[R.HA_PANEL_LOVELACE]:{selector:H.HA_PANEL_LOVELACE,children:{shadowRoot:{selector:N,children:{[R.HUI_ROOT]:{selector:H.HUI_ROOT,children:{shadowRoot:{selector:N,children:{[R.HEADER]:{selector:H.HEADER},[R.HUI_VIEW]:{selector:H.HUI_VIEW}}}}}}}}}}}},p={shadowRoot:{selector:N,children:{[v.HA_MORE_INFO_DIALOG]:{selector:H.HA_MORE_INFO_DIALOG,children:{shadowRoot:{selector:N,children:{[v.HA_DIALOG]:{selector:H.HA_DIALOG,children:{[v.HA_DIALOG_CONTENT]:{selector:H.HA_DIALOG_CONTENT,children:{[v.HA_MORE_INFO_DIALOG_INFO]:{selector:H.HA_MORE_INFO_DIALOG_INFO},[v.HA_DIALOG_MORE_INFO_HISTORY_AND_LOGBOOK]:{selector:H.HA_DIALOG_MORE_INFO_HISTORY_AND_LOGBOOK},[v.HA_DIALOG_MORE_INFO_SETTINGS]:{selector:H.HA_DIALOG_MORE_INFO_SETTINGS}}}}}}}}}}}},D=(e,t,n=null,o=!1)=>Object.entries(t||{}).reduce(((t,i)=>{const[s,r]=i;if(r.selector===N&&n)return r.children?Object.assign(Object.assign({},t),D(e,r.children,n,!0)):t;const a=n?n.then((t=>{return f(t,(n=r.selector,o?"$ "+n:n),e);var n})):f(r.selector,e);return t[s]={element:a,children:D(e,r.children,a),selector:new E(a,e)},t}),{}),M=(e,t)=>{const n=Object.entries(t);for(const t of n){if(t[0]===e)return t[1];{const n=M(e,t[1].children);if(n)return n}}},y=(e,t)=>Object.keys(e).reduce(((e,n)=>{const o=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}(M(n,t),["children"]);return e[n]=Object.assign({},o),e}),{});var G,b,g,F,P,C,W,V,j,k,U,$,B,x,q,Y,K,Q,z,J,X,Z,ee,te,ne;class oe extends EventTarget{constructor(e={}){super(),G.add(this),b.set(this,void 0),g.set(this,void 0),F.set(this,void 0),P.set(this,void 0),C.set(this,void 0),W.set(this,void 0),V.set(this,void 0),j.set(this,void 0),k.set(this,void 0),U.set(this,void 0),$.set(this,void 0),B.set(this,void 0),x.set(this,void 0),q.set(this,void 0),Y.set(this,void 0),K.set(this,void 0),I(this,b,Object.assign(Object.assign({},L),e),"f")}listen(){I(this,B,u(this,G,"m",Z).bind(this),"f"),I(this,x,u(this,G,"m",ee).bind(this),"f"),I(this,q,u(this,G,"m",te).bind(this),"f"),I(this,Y,u(this,G,"m",ne).bind(this),"f"),I(this,j,new MutationObserver(u(this,B,"f")),"f"),I(this,k,new MutationObserver(u(this,x,"f")),"f"),I(this,U,new MutationObserver(u(this,q,"f")),"f"),I(this,$,new MutationObserver(u(this,Y,"f")),"f"),u(this,G,"m",J).call(this),u(this,G,"m",X).call(this)}addEventListener(e,t,n){super.addEventListener(e,t,n)}}b=new WeakMap,g=new WeakMap,F=new WeakMap,P=new WeakMap,C=new WeakMap,W=new WeakMap,V=new WeakMap,j=new WeakMap,k=new WeakMap,U=new WeakMap,$=new WeakMap,B=new WeakMap,x=new WeakMap,q=new WeakMap,Y=new WeakMap,K=new WeakMap,G=new WeakSet,Q=function(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t}))},z=function(e=v.HA_MORE_INFO_DIALOG_INFO){I(this,g,D(u(this,b,"f"),p,u(this,W,"f").HOME_ASSISTANT.element),"f");const t=y(v,u(this,g,"f"));t.HA_DIALOG_CONTENT.element.then((e=>{u(this,k,"f").disconnect(),u(this,k,"f").observe(e,{childList:!0})})),I(this,C,((e,t)=>[v.HA_MORE_INFO_DIALOG,v.HA_DIALOG,v.HA_DIALOG_CONTENT,t].reduce(((t,n)=>(t[n]=e[n],t)),{}))(t,e),"f");const n={[v.HA_MORE_INFO_DIALOG_INFO]:T.ON_LOVELACE_MORE_INFO_DIALOG_OPEN,[v.HA_DIALOG_MORE_INFO_HISTORY_AND_LOGBOOK]:T.ON_LOVELACE_HISTORY_AND_LOGBOOK_DIALOG_OPEN,[v.HA_DIALOG_MORE_INFO_SETTINGS]:T.ON_LOVELACE_SETTINGS_DIALOG_OPEN};u(this,G,"m",Q).call(this,n[e],u(this,C,"f"))},J=function(){I(this,F,D(u(this,b,"f"),m),"f"),I(this,W,y(w,u(this,F,"f")),"f"),u(this,W,"f")[w.HOME_ASSISTANT].selector.$.element.then((e=>{u(this,j,"f").disconnect(),u(this,j,"f").observe(e,{childList:!0})}))},X=function(){const e=Date.now();e-u(this,K,"f")<500||(I(this,K,e,"f"),I(this,P,D(u(this,b,"f"),S,u(this,W,"f")[w.HA_DRAWER].element),"f"),I(this,V,y(R,u(this,P,"f")),"f"),u(this,V,"f")[R.PARTIAL_PANEL_RESOLVER].element.then((e=>{u(this,U,"f").disconnect(),u(this,U,"f").observe(e,{childList:!0})})),u(this,V,"f")[R.HA_PANEL_LOVELACE].selector.$.element.then((e=>{u(this,$,"f").disconnect(),u(this,$,"f").observe(e,{childList:!0})})),u(this,G,"m",Q).call(this,T.ON_LOVELACE_PANEL_LOAD,Object.assign(Object.assign({},u(this,W,"f")),u(this,V,"f"))))},Z=function(e){e.forEach((({addedNodes:e})=>{e.forEach((e=>{e.localName===H.HA_MORE_INFO_DIALOG&&u(this,G,"m",z).call(this)}))}))},ee=function(e){e.forEach((({addedNodes:e})=>{e.forEach((e=>{const t={[H.HA_MORE_INFO_DIALOG_INFO]:v.HA_MORE_INFO_DIALOG_INFO,[H.HA_DIALOG_MORE_INFO_HISTORY_AND_LOGBOOK]:v.HA_DIALOG_MORE_INFO_HISTORY_AND_LOGBOOK,[H.HA_DIALOG_MORE_INFO_SETTINGS]:v.HA_DIALOG_MORE_INFO_SETTINGS};if(e.localName&&e.localName in t){const n=e.localName;u(this,G,"m",z).call(this,t[n])}}))}))},te=function(e){e.forEach((({addedNodes:e})=>{e.forEach((e=>{e.localName===H.HA_PANEL_LOVELACE&&u(this,G,"m",X).call(this)}))}))},ne=function(e){e.forEach((({addedNodes:e})=>{e.forEach((e=>{e.localName===H.HUI_ROOT&&u(this,G,"m",X).call(this)}))}))};var ie;!function(e){e.HUI_VIEW="hui-view",e.MORE_INFO_CONTENT="more-info-content",e.MORE_INFO_DEFAULT="more-info-default",e.MORE_INFO_VACUUM="more-info-vacuum",e.MORE_INFO_LIGHT="more-info-light",e.HA_ATTRIBUTES="ha-attributes"}(ie||(ie={}));const se=/[.?+^$[\]\\(){}|-]/g;var re,ae,ce;console.info("%c  Custom-attributes  \n%c  Version 20231211 Custom attributes for Home Assistant","color: gold; font-weight: bold; background: black","color: white; font-weight: bold; background: steelblue");class le{constructor(){re.set(this,void 0),ae.set(this,void 0),ce.set(this,void 0),t(this,re,new oe,"f"),e(this,re,"f").addEventListener(T.ON_LOVELACE_PANEL_LOAD,(e=>{this.storeConfig(e.detail)})),e(this,re,"f").addEventListener(T.ON_LOVELACE_MORE_INFO_DIALOG_OPEN,(e=>{this.queryAttributes(e.detail)})),e(this,re,"f").listen()}storeConfig(e){e.HA_PANEL_LOVELACE.element.then((e=>{var n,o;t(this,ae,(null===(o=null===(n=null==e?void 0:e.lovelace)||void 0===n?void 0:n.config)||void 0===o?void 0:o.custom_attributes)||{},"f"),t(this,ce,{},"f")}))}queryAttributes(e){e.HA_MORE_INFO_DIALOG_INFO.selector.$.query(ie.MORE_INFO_CONTENT).$.query([ie.MORE_INFO_DEFAULT,ie.MORE_INFO_VACUUM,ie.MORE_INFO_LIGHT].join(",")).$.query(ie.HA_ATTRIBUTES).element.then((e=>{e&&this.applyFilters(e)}))}applyFilters(e){const t=e.__stateObj.entity_id,n=e.__stateObj.attributes.device_class,o=this.getFilters(t,n),i=e.extraFilters||"",s=i.length?",":"";e.extraFilters=i+s+o.join(",")}getFilters(t,n){var o;if(e(this,ce,"f")[t])return e(this,ce,"f")[t];const i=new Set,s=null===(o=e(this,ae,"f"))||void 0===o?void 0:o.filter_attributes,r=null==s?void 0:s.by_entity_id,a=null==s?void 0:s.by_glob,c=null==s?void 0:s.by_domain,l=null==s?void 0:s.by_device_class;return a&&Object.entries(a).forEach((e=>{const[n,o]=e;this.getEntityIdRegExp(n).test(t)&&o.forEach((e=>{i.add(e)}))})),(null==l?void 0:l[n])&&(i.clear(),l[n].forEach((e=>{i.add(e)}))),c&&Object.entries(c).forEach((e=>{const[n,o]=e;t.startsWith(`${n}.`)&&(i.clear(),o.forEach((e=>{i.add(e)})))})),(null==r?void 0:r[t])&&(i.clear(),r[t].forEach((e=>{i.add(e)}))),e(this,ce,"f")[t]=Array.from(i.values()),e(this,ce,"f")[t]}getEntityIdRegExp(e){const t=e.replace(se,"\\$&").replace(/\*/g,".*");return new RegExp(`^${t}$`)}}re=new WeakMap,ae=new WeakMap,ce=new WeakMap,Promise.resolve(customElements.whenDefined(ie.HUI_VIEW)).then((()=>{window.customAttributes=new le}))}();
